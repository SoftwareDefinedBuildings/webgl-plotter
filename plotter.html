<html>
    <head>
        <title>WebGL Plotting Tool</title>
        <style>
            body {
                margin: 0;
            }
            canvas {
                width: 100%;
                height: 100%;
            }
        </style>
    </head>
    <body>
        <script src="http://threejs.org/build/three.min.js"></script>
        <script>
            function ColorBox(width, height, depth) {
                var geom = new THREE.BoxGeometry(width, height, depth);
                var material = new THREE.MeshBasicMaterial({color: 0xffffff});
                this.obj = new THREE.Mesh(geom, material);
                this.obj.wrapper = this; // an extra parameter I'm adding
                this.target = null;
                this.selected = false;
            }
            
            ColorBox.prototype.addToScene = function () {
                scene.add(this.obj);
                objs.push(this.obj);
            }
            
            ColorBox.prototype.setPosition = function (x, y, z) {
                this.obj.position.set(x, y, z);
            }
            
            ColorBox.prototype.setTarget = function (otherBox) {
                this.target = otherBox;
            }
            
            ColorBox.prototype.click = function () {
                if (this.target.selected) {
                    this.target.obj.material.setValues({color: 0xffffff});
                    this.target.selected = false;
                } else {
                    this.target.obj.material.setValues({color: 0xff0000});
                    this.target.selected = true;
                }
            }
        
            var scene = new THREE.Scene();
            var objs = [];
            var camera = new THREE.PerspectiveCamera( 90, window.innerWidth/window.innerHeight, 0.1, 1000 );
            var renderer = new THREE.WebGLRenderer();
            renderer.setSize( window.innerWidth, window.innerHeight );
            document.body.appendChild( renderer.domElement );
            var boxes = [null, null, null, null];
            for (var i = 0; i < 4; i++) {
                boxes[i] = new ColorBox(2, 2, 0.1);
                boxes[i].addToScene(scene);
            }
            boxes[0].setPosition(-10, -10, -20);
            boxes[1].setPosition(10, -10, -20);
            boxes[2].setPosition(-10, 10, -20);
            boxes[3].setPosition(10, 10, -20);
            
            boxes[0].setTarget(boxes[3]);
            boxes[3].setTarget(boxes[0]);
            boxes[1].setTarget(boxes[2]);
            boxes[2].setTarget(boxes[1]);

            var render = function () {
                    requestAnimationFrame( render );
                    renderer.render(scene, camera);
                };
            render();
            
            document.onclick = function (event) {
                    var coordX = event.clientX / (window.innerWidth / 2) - 1;
                    var coordY = -1 * (event.clientY / (window.innerHeight / 2) - 1);
                    var mouseDir = new THREE.Vector3(coordX, coordY, 0.5);
                    
                    mouseDir.unproject(camera); // get the coordinates in 3D space
                    mouseDir.sub(camera.position); // get a vector pointing from the camera to the mouseclick (unchanged since the camera is at (0, 0, 0))
                    mouseDir.normalize(); // make its magnitude 1
                    
                    var ray = new THREE.Raycaster(camera.position, mouseDir);
                    var intersections = ray.intersectObjects(objs);
                    
                    var obj;
                    if (intersections.length > 0) {
                        obj = intersections[0].object;
                        if (obj.hasOwnProperty("wrapper") && "click" in obj.wrapper) {
                            obj.wrapper.click();
                        }
                    }
                };
        </script>
    </body>
</html>
